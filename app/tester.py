import socket
import threading
import pickle

import rsa
__server_public_key__ = rsa.PublicKey(531836556116849503526789038592954213414151379898321835881401907556007177415927997307542592331199274089794331573843691592574639966270561486557382534282742103050057822993660888083548379856155488483196639832097391417134087217005299569802699831391478549250744498375602059643144903775349274801998146688120183504125221051061736348327457268507586608176443284233413990577635177136336631459383851827187507721004587701804374282750434372917940361127765542157619677292146401841569985916480798394424532280393237433015726920840531167288665933370139294868651026141601666325426407672025889314600906028786618408177562737233790002944266034792992474306740850812523601523756217918206069415070327585539353356359071939307735577061091608639360563326396192850344390658852913223887011225691903782488742287948888014633114365077164593903473318600607600949451658093178850075458821016403433532568744679880492952441636867853655522362814535616187809821323397068788947480892419246810990841597653670945038818458829019200666865229015233677540241824247978388149314379895411043381152108020013195083056299043554246377658123133279533462604856780710681653462894342224519486425570059768811070058412378593332019844589337496030320729967749686813819445032235455418790559505833, 65537)

if __name__ == '__main__':
    srv_adr = '127.0.0.1'
    srv_port = 27526

    def ms_send(client: socket.socket, msg):

        drop = list()
        for value in msg:
            enc_msg = rsa.encrypt(value.encode(), __server_public_key__)
            drop.append(enc_msg)

        packet = pickle.dumps(drop)
        print(packet)
        client.send(packet)


    def rec(client : socket.socket):
        while True:
            msg = client.recv(4096)
            print(msg)


    client_sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    client_sock.connect((srv_adr, srv_port))

    recThread = threading.Thread(target= rec, args= [client_sock])
    recThread.start()

    drop = ['#0000', 'publickey']

    ms_send(client_sock, drop)



